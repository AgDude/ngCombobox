/*! ngCombobox v2.0.1, License: MIT, Generated at 2014-06-30 13:16:26 -0500 */!function(){"use strict";function a(){var a={};return{on:function(b,c){return b.split(" ").forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},trigger:function(b,c){return angular.forEach(a[b],function(a){a.call(null,c)}),this}}}function b(a,b){return a=a||[],a.length>0&&!angular.isObject(a[0])&&a.forEach(function(c,d){a[d]={},a[d][b]=c}),a}function c(a,b,c){for(var d=null,e=0;e<a.length;e++)if(a[e][c].toLowerCase()===b[c].toLowerCase()){d=a[e];break}return d}function d(a,b,c){var d=b.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");return a.replace(new RegExp(d,"gi"),c)}var e={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188,period:190,dot:110},f=angular.module("ngCombobox",[]).factory("grep",function(){return function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e}});f.factory("SuggestionList",["$timeout","$interval","$q",function(a,d){return function(e,f,g){var h,i,j,k,l={};return j=function(a,b){return a.filter(function(a){return!c(b,a,g.displayProperty)})},l.reset=function(){k=null,l.items=[],l.visible=!1,l.loading=!1,l.index=-1,l.selected=null,l.query=null,a.cancel(h),d.cancel(i)},l.show=function(){l.selected=null,l.visible=!0,l.loading=!1,l.select(0)},l.loadingFn=function(a){var b=0;i=d(function(){b++;var c=new Array(b%6).join(".");l.msg=a+c},250)},l.load=function(c,m,n,o){return c.length<g.minLength&&!n?void l.reset():(void 0==o&&(o=e),d.cancel(i),l.msg=angular.copy(g.loadingMsg),o==f&&(l.msg=angular.copy(g.secondaryMsg)),a.cancel(h),void(h=a(function(){l.query=c;var d=o({$query:c});l.msg&&(l.loadingFn(l.msg),a(function(){l.loading=!0})),k=d,d.then(function(a){if(d===k){if(a=b(a.data||a,g.displayProperty),a=j(a,m),f&&0===a.length&&o===e)return l.visible=!1,l.load(c,m,n,f);l.more=Math.max(0,a.length-g.maxResultsToShow),l.items=a.slice(0,g.maxResultsToShow),l.items.length>0?l.show():l.reset()}})},g.debounceDelay,!1)))},l.selectNext=function(){l.select(++l.index)},l.selectPrior=function(){l.select(--l.index)},l.select=function(a){0>a?a=l.items.length-1:a>=l.items.length&&(a=0),l.index=a,l.selected=l.items[a]},l.reset(),l}}]).factory("encodeHTML",function(){return function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}).factory("TagList",function(){return function(a,b){var d,e,f,g={};return d=function(b){return b[a.displayProperty]},e=function(b,c){b[a.displayProperty]=c},f=function(b){var e=d(b);return e.length>=a.minLength&&e.length<=(a.maxLength||e.length)&&a.allowedTagsPattern.test(e)&&!c(g.items,b,a.displayProperty)},g.items=[],g.addText=function(a){if(a){var c={};return e(c,a),b.trigger("new-tag-added",c),g.add(c)}},g.add=function(c){var h=d(c).trim();return a.replaceSpacesWithDashes&&(h=h.replace(/\s/g,"-")),e(c,h),f(c)?(g.items.push(c),b.trigger("tag-added",{$tag:c})):b.trigger("invalid-tag",{$tag:c}),c},g.remove=function(a){var c=g.items.splice(a,1)[0];return b.trigger("tag-removed",{$tag:c}),c},g.removeLast=function(){var b,c=g.items.length-1;return a.enableEditingLastTag||g.selected?(g.selected=null,b=g.remove(c)):g.selected||(g.selected=g.items[c]),b},g}}),f.directive("combobox",["$timeout","$document","$sce","$q","grep","SuggestionList","TagList","encodeHTML","tagsInputConfig",function(c,f,g,h,i,j,k,l,m){return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&",newTagAdded:"=?",source:"=?",secondarySource:"=?"},replace:!1,transclude:!0,templateUrl:"ngCombobox/combobox.html",controller:["$scope","$attrs","$element",function(b,c){m.load("ngCombobox",b,c,{placeholder:[String,""],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,2],maxLength:[Number],showTotal:[Boolean,!0],addOnEnter:[Boolean,!0],addOnTab:[Boolean,!0],addOnSpace:[Boolean,!0],addOnComma:[Boolean,!0],addOnPeriod:[Boolean,!0],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number],maxTags:[Number],displayProperty:[String,"text"],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!0],showAll:[Boolean,!0],debounceDelay:[Number,100],minSearchLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadingMsg:[String,""],secondaryMsg:[String,""],savingMsg:[String,""]}),b.events=new a,b.tagList=new k(b.options,b.events)}],link:{post:function(a,k,m,n){function o(b){return function(c){var d=c.$query,e=new RegExp(d,"i"),f=h.defer(),g=i(a[b],function(a){return e.test(a.text)});return g.sort(function(a,b){return 0===a.text.indexOf(d)||0===b.text.indexOf(d)?a.text.indexOf(d)-b.text.indexOf(d):0}),f.resolve(g),f.promise}}var p,q,r,s,t,u=[e.enter,e.tab,e.escape,e.up,e.down,e.dot,e.period,e.space,e.comma,e.backspace],v=a.options,w=a.tagList,x=a.events,y=k.find("input"),z=k.find("option");if(z.length>0){var A=[],B=[];n.$isEmpty()||(A=n.$viewValue),angular.forEach(z,function(a){var b={value:a.value,text:a.label};B.push(b),a.selected&&A.push(b),angular.element(a).remove()}),a.source=B,n.$setViewValue(A)}x.on("tag-added",a.onTagAdded).on("tag-removed",a.onTagRemoved).on("tag-added",function(){a.newTag.text="",y.removeAttr("placeholder")}).on("tag-added tag-removed",function(){n.$setViewValue(a.tags),a.$eval(m.ngChange)}).on("tag-added invalid-tag",function(){p.reset()}).on("invalid-tag",function(){a.newTag.invalid=!0}).on("input-change",function(b){w.selected=null,a.newTag.invalid=null,b?p.load(b,a.tags):p.reset()}).on("input-focus",function(){n.$setValidity("leftoverText",!0)}).on("input-blur",function(){v.addFromAutocompleteOnly||(v.addOnBlur&&w.addText(a.newTag.text),n.$setValidity("leftoverText",v.allowLeftoverText?!0:!a.newTag.text))}).on("new-tag-added",function(b){void 0!==a.newTagAdded&&(v.savingMsg&&(p.newSaving=!0),a.newTagAdded(b).then(function(a){if(a.hasOwnProperty("data"))for(var c in a.data)b[c]=a.data[c]})["finally"](function(){p.newSaving=!1}))}),a.newTag={text:"",invalid:null,readonly:!1},a.getDisplayText=function(a){return a[v.displayProperty].trim()},a.track=function(a){return a[v.displayProperty]},a.newTagChange=function(){x.trigger("input-change",a.newTag.text)},a.$watch("tags",function(c){a.tags=b(c,v.displayProperty),w.items=a.tags}),a.$watch("tags.length",function(b){a.newTag.readonly=b>=v.maxTags,n.$setValidity("maxTags",angular.isUndefined(v.maxTags)||b<=v.maxTags),n.$setValidity("minTags",angular.isUndefined(v.minTags)||b>=v.minTags)}),s="function"==typeof a.source?a.source:o("source"),"function"==typeof a.secondarySource?t=a.secondarySource:void 0!==a.secondarySource&&(t=o("secondarySource")),p=new j(s,t,v),a.suggestionList=p,q=function(a){return a[v.displayProperty]},a.toggleSuggestionList=function(){p.visible?p.reset():p.load(a.newTag.text,a.tags,!0)},a.addSuggestion=function(){var b=!1;return a.tags.length>=a.options.maxTags&&a.tags.pop(),p.selected&&(a.tagList.add(p.selected),p.reset(),y[0].focus(),b=!0),b},a.highlight=function(a){var b=q(a);return b=l(b),v.highlightMatchedText&&(b=d(b,l(p.query),"<em>$&</em>")),g.trustAsHtml(b)},a.track=function(a){return q(a)};var C={};C[e.enter]=v.addOnEnter,C[e.tab]=v.addOnTab,C[e.comma]=v.addOnComma,C[e.space]=v.addOnSpace,C[e.period]=v.addOnPeriod,C[e.dot]=v.addOnPeriod,a.addKeys=C,y.on("keydown",function(b){var d,f,g,h=b.keyCode,i=b.shiftKey||b.altKey||b.ctrlKey||b.metaKey,j=!1;if(!i&&-1!==u.indexOf(h)){if(p.visible?h===e.down?(p.selectNext(),j=!0):h===e.up?(p.selectPrior(),j=!0):h===e.escape?(p.reset(),j=!0):a.addKeys[h]&&(j=a.addSuggestion()):h===e.down&&(a.toggleSuggestionList(),j=!0),d=!v.addFromAutocompleteOnly&&C[h],f=!d&&h===e.backspace&&0===a.newTag.text.length,g=v.addFromAutocompleteOnly&&a.newTag.invalid&&C[h],d)w.addText(a.newTag.text),a.$apply(),b.preventDefault();else if(f){var k=w.removeLast();k&&v.enableEditingLastTag&&(a.newTag.text=k[v.displayProperty]),a.$apply(),b.preventDefault()}else g&&(a.newTag.text="Invalid Entry...",a.newTag.readonly=!0,a.$apply(),c(function(){a.newTag.text="",a.newTag.readonly=!1},2e3));j&&(h!==e.tab&&b.preventDefault(),a.$apply())}}).on("focus",function(){a.hasFocus||(a.hasFocus=!0,x.trigger("input-focus"),a.$apply())}).on("blur",function(){c(function(){var b=f.prop("activeElement"),c=b===y[0],d=k[0].contains(b);(c||!d)&&(a.hasFocus=!1,p.reset(),x.trigger("input-blur"))})}),k.find("div").on("click",function(){y[0].focus()}),r=function(){p.visible&&(p.reset(),a.$apply())},f.on("click",r),a.$on("$destroy",function(){f.off("click",r)})}}}}]),f.directive("tiTranscludePrepend",function(){return function(a,b,c,d,e){e(function(a){b.prepend(a)})}}),f.provider("tagsInputConfig",function(){var a={},b={};this.setDefaults=function(b,c){return a[b]=c,this},this.setActiveInterpolation=function(a,c){return b[a]=c,this},this.$get=["$interpolate",function(c){var d={};return d[String]=function(a){return a},d[Number]=function(a){return parseInt(a,10)},d[Boolean]=function(a){return"true"===a.toLowerCase()},d[RegExp]=function(a){return new RegExp(a)},{load:function(e,f,g,h){f.options={},angular.forEach(h,function(h,i){var j,k,l,m,n;j=h[0],k=h[1],l=d[j],m=function(){var b=a[e]&&a[e][i];return angular.isDefined(b)?b:k},n=function(a){f.options[i]=a?l(a):m()},b[e]&&b[e][i]?g.$observe(i,function(a){n(a)}):n(g[i]&&c(g[i])(f.$parent))})}}}]}),f.run(["$templateCache",function(a){a.put("ngCombobox/combobox.html",'<div class="host" ng-class="{\'input-group\': options.showAll && source}" tabindex="-1" ti-transclude-prepend=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by $id(tag)" ng-class="{ selected: tag == tagList.selected }"><span>{{getDisplayText(tag)}}</span> <a class="remove-button" ng-click="tagList.remove($index)">{{options.removeTagSymbol}}</a></li></ul><input class="input" placeholder="{{options.placeholder}}" tabindex="{{options.tabindex}}" ng-model="newTag.text" ng-readonly="newTag.readonly" ng-change="newTagChange()" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ti-autosize=""></div><div class="autocomplete" ng-show="!suggestionList.visible && suggestionList.newSaving"><ul class="suggestion-list"><li class="suggestion-item">{{ options.savingMsg }}</li></ul></div><div class="autocomplete" ng-show="!suggestionList.visible && suggestionList.loading"><ul class="suggestion-list"><li class="suggestion-item">{{ suggestionList.msg }}</li></ul></div><div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by $id(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"></li><li class="suggestion-item" ng-show="options.showTotal && suggestionList.more">... and {{ suggestionList.more }} more</li></ul></div><span class="input-group-addon" ng-if="options.showAll" ng-click="toggleSuggestionList();"><span class="ui-button-icon-primary ui-icon ui-icon-triangle-1-s"><span class="ui-button-text" style="padding: 0px">&nbsp;</span></span></span></div>')}])}();